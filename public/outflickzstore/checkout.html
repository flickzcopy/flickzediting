<!DOCTYPE html>
<html lang="en" class="text-[90%] sm:text-[95%] md:text-[100%]">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout - Outflickz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" type="image/png" href="https://i.imgur.com/ioWFyQB.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://js.paystack.co/v1/inline.js"></script> 
    <script>
        // Custom Tailwind Configuration (for colors like ash-red, ash-dark, etc.)
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'ash-dark': '#1e293b', // Slate-800 equivalent
                        'ash-red': '#dc2626', // Red-600 equivalent
                        'color-white': '#ffffff',
                        'color-black': '#000000',
                    },
                }
            }
        }
    </script>
    <style>
        /* Load Inter (main font) and Playfair Display (for "OUTFLICKZ" logo) */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&family=Playfair+Display:ital,wght@0,400..900;1,400..900&display=swap');

        /* Custom styles */
        body {
            font-family: 'Inter', sans-serif;
        }

        /* Hide number input arrows/spinners */
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type="number"] {
            -moz-appearance: textfield;
        }

        /* Custom styles for the message modal */
        #message-modal-container {
            background-color: rgba(0, 0, 0, 0.5); /* Semi-transparent black overlay */
            transition: opacity 0.3s ease-in-out;
        }
        .modal-content {
            transform: translateY(0);
            transition: transform 0.3s ease-in-out;
        }
        #message-modal-container.hidden .modal-content {
            transform: translateY(-50px);
        }
        
        /* Step indicator styling */
        .step-active {
            @apply bg-ash-red text-white;
        }
        .step-inactive {
            @apply bg-gray-200 text-gray-500;
        }
        .step-complete {
            @apply bg-green-500 text-white;
        }
        
        /* Bank details toggle button icon rotation */
        .bank-toggle[aria-expanded="true"] svg {
            transform: rotate(180deg);
        }
        
        /* Added for better readability on small screens */
        .bank-details-content p span {
            word-break: break-all;
        }
    </style>
</head>
<body class="bg-gray-50 text-color-black min-h-screen">

    <div id="message-modal-container" class="fixed inset-0 z-[100] hidden flex justify-center items-start pt-10" role="alert" aria-live="assertive">
        <div class="modal-content bg-ash-dark text-white p-4 rounded-lg shadow-2xl max-w-sm w-full relative">
            <p id="message-modal-text" class="text-sm font-medium"></p>
            <button id="message-modal-close-btn" class="absolute top-1 right-1 text-gray-400 hover:text-white transition" aria-label="Close message">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>
    
    <header class="bg-color-white sticky top-0 z-50 shadow-md border-b border-gray-100">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-14 sm:h-16 flex items-center justify-between">
            <a href="homepage.html" class="flex items-center" aria-label="Outflickz Home">
                <img src="https://i.imgur.com/PZLMws6.jpeg" alt="Outflickz Logo" class="w-auto h-10 sm:h-12 lg:h-10">
            </a>
            <nav class="hidden md:flex flex-grow justify-center space-x-6 lg:space-x-10 text-sm" aria-label="Main Navigation">
                <a href="homepage.html" class="font-medium text-color-black hover:text-gray-600 transition">Homepage</a>
                <a href="checkout.html" class="font-bold text-ash-red transition flex items-center border-b-2 border-ash-red">Checkout</a>
                 <a href="wearscollection.html" class="font-medium text-color-black hover:text-gray-600 transition">Wears Collection</a>
                <a href="newarrivals.html" class="font-medium text-color-black hover:text-gray-600 transition">New Arrivals</a>
                <a href="capcollection.html" class="font-medium text-color-black hover:text-gray-600 transition flex items-center">Cap Collections</a>
                <a href="preorder.html" class="font-medium text-color-black hover:text-gray-600 transition">Pre Order</a>
            </nav>


            <div class="flex items-center space-x-2 sm:space-x-4">
                <button id="profile-icon" 
                class="p-1 sm:p-2 text-gray-700 hover:text-ash-dark transition rounded-full hidden md:block" 
                aria-label="User Account"
                onclick="redirectToProfileOrLogin()">
                    <i class="fas fa-user w-4 h-4 sm:w-5 sm:h-5"></i>
                </button>
                <a href="cart.html" class="relative p-1 sm:p-2 text-gray-700 hover:text-ash-dark transition rounded-full" aria-label="Shopping Bag">
                    <i class="fas fa-shopping-bag w-4 h-4 sm:w-5 sm:h-5"></i>
                    <span id="cart-badge" class="absolute top-0 right-0 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-white transform translate-x-1/2 -translate-y-1/2 bg-ash-red rounded-full hidden">
                        0
                    </span>
                </a>
                <button class="md:hidden p-1 sm:p-2 text-gray-700 hover:text-ash-dark transition rounded-full" onclick="toggleMenu()" aria-expanded="false" aria-controls="mobile-menu" aria-label="Open main menu">
                    <i class="fas fa-bars w-5 h-5 sm:w-6 sm:h-6"></i>
                </button>
            </div>
        </div>
    </header>

    <div id="mobile-menu" class="hidden md:hidden bg-color-white border-b border-gray-100 absolute w-full z-40 shadow-lg">
        <div class="px-2 pt-2 pb-3 space-y-1 text-sm">
            <a href="homepage.html" class="block px-3 py-2 font-medium text-gray-700 hover:bg-gray-100 rounded-md">Homepage</a>
             <a href="wearscollection.html" class="block px-3 py-2 font-bold text-ash-red bg-gray-100 rounded-md">Wears Collection</a>
            <a href="newarrivals.html" class="block px-3 py-2 font-medium text-gray-700 hover:bg-gray-100 rounded-md">New Arrivals</a>
            <a href="capcollection.html" class="block px-3 py-2 font-medium text-gray-700 hover:bg-gray-100 rounded-md">Cap Collection</a>
            <a href="preorder.html" class="block px-3 py-2 font-medium text-gray-700 hover:bg-gray-100 rounded-md">Pre Order</a>

            <button 
                id="mobile-profile-login-button" 
                class="w-full flex items-center px-3 py-2 font-medium text-gray-700 hover:bg-gray-100 rounded-md text-left"
                aria-label="User Account or Login"
                onclick="redirectToProfileOrLogin()">
                <i class="fas fa-user w-4 h-4 mr-3"></i>
                Account / Login
            </button>
            </div>
    </div>
    
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10 sm:py-12">
        <h1 class="text-3xl sm:text-4xl font-extrabold text-ash-dark mb-8 uppercase tracking-wide">
            üí≥ Secure Checkout
        </h1>

        <div class="flex justify-between items-center mb-10 text-center relative">
            <div class="absolute inset-x-0 top-4 h-0.5 bg-gray-200 z-0 hidden sm:block"></div> <div class="flex-1 z-10">
                <div id="step-indicator-1" class="step-indicator step-active w-8 h-8 rounded-full flex items-center justify-center mx-auto mb-1 text-sm font-bold">1</div>
                <span class="text-xs sm:text-sm text-ash-dark font-medium">Shipping Info</span>
            </div>
            
            <div class="flex-1 z-10">
                <div id="step-indicator-2" class="step-indicator step-inactive w-8 h-8 rounded-full flex items-center justify-center mx-auto mb-1 text-sm font-bold">2</div>
                <span class="text-xs sm:text-sm text-gray-500">Review Order</span>
            </div>
            
            <div class="flex-1 z-10">
                <div id="step-indicator-3" class="step-indicator step-inactive w-8 h-8 rounded-full flex items-center justify-center mx-auto mb-1 text-sm font-bold">3</div>
                <span class="text-xs sm:text-sm text-gray-500">Payment</span>
            </div>
        </div> 
        
        <div class="lg:grid lg:grid-cols-3 lg:gap-10">
            
            <div class="lg:col-span-2 space-y-8">
                
                <section id="shipping-info-section" class="bg-white p-6 sm:p-8 rounded-lg shadow-md border border-gray-100">
                    <h2 class="text-xl sm:text-2xl font-bold text-ash-dark mb-6 border-b pb-4">1. Contact & Shipping Information</h2>
                    <form id="shipping-form" onsubmit="event.preventDefault(); validateAndProceedToReview();">
                        <div class="grid grid-cols-1 gap-y-6 sm:grid-cols-2 sm:gap-x-6">
                            <div class="sm:col-span-2">
                                <label for="email" class="block text-sm font-medium text-gray-700">Email address (for confirmations) <span class="text-ash-red">*</span></label>
                                <input type="email" id="email" name="email" autocomplete="email" required class="mt-1 block w-full border border-gray-300 rounded-sm shadow-sm py-2 px-3 focus:outline-none focus:ring-ash-red focus:border-ash-red" placeholder="e.g., john.doe@example.com">
                            </div>
                            <div class="sm:col-span-2 border-t border-gray-200 pt-6 mt-6">
                                <h3 class="text-lg font-semibold text-gray-900 mb-3">Shipping Details</h3>
                            </div>

                            <div>
                                <label for="first-name" class="block text-sm font-medium text-gray-700">First name <span class="text-ash-red">*</span></label>
                                <input type="text" id="first-name" name="first-name" autocomplete="given-name" required class="mt-1 block w-full border border-gray-300 rounded-sm shadow-sm py-2 px-3 focus:outline-none focus:ring-ash-red focus:border-ash-red">
                            </div>
                            <div>
                                <label for="last-name" class="block text-sm font-medium text-gray-700">Last name <span class="text-ash-red">*</span></label>
                                <input type="text" id="last-name" name="last-name" autocomplete="family-name" required class="mt-1 block w-full border border-gray-300 rounded-sm shadow-sm py-2 px-3 focus:outline-none focus:ring-ash-red focus:border-ash-red">
                            </div>
                            <div class="sm:col-span-2">
                                <label for="address-line-1" class="block text-sm font-medium text-gray-700">Street address <span class="text-ash-red">*</span></label>
                                <input type="text" id="address-line-1" name="address-line-1" autocomplete="street-address" required class="mt-1 block w-full border border-gray-300 rounded-sm shadow-sm py-2 px-3 focus:outline-none focus:ring-ash-red focus:border-ash-red">
                            </div>
                            <div>
                                <label for="city" class="block text-sm font-medium text-gray-700">City <span class="text-ash-red">*</span></label>
                                <input type="text" id="city" name="city" autocomplete="address-level2" required class="mt-1 block w-full border border-gray-300 rounded-sm shadow-sm py-2 px-3 focus:outline-none focus:ring-ash-red focus:border-ash-red">
                            </div>
                            <div>
                                <label for="state" class="block text-sm font-medium text-gray-700">State / Province <span class="text-ash-red">*</span></label>
                                <input type="text" id="state" name="state" autocomplete="address-level1" required class="mt-1 block w-full border border-gray-300 rounded-sm shadow-sm py-2 px-3 focus:outline-none focus:ring-ash-red focus:border-ash-red">
                            </div>
                            <div>
                                <label for="zip-code" class="block text-sm font-medium text-gray-700">ZIP / Postal code <span class="text-ash-red">*</span></label>
                                <input type="text" id="zip-code" name="zip-code" autocomplete="postal-code" required class="mt-1 block w-full border border-gray-300 rounded-sm shadow-sm py-2 px-3 focus:outline-none focus:ring-ash-red focus:border-ash-red">
                            </div>
                            <div>
                                <label for="country" class="block text-sm font-medium text-gray-700">Country <span class="text-ash-red">*</span></label>
                                <select id="country" name="country" autocomplete="country-name" required class="mt-1 block w-full border border-gray-300 rounded-sm shadow-sm py-2 px-3 focus:outline-none focus:ring-ash-red focus:border-ash-red">
                                    <option value="Nigeria">Nigeria</option>
                                    <option value="Ghana">Ghana</option>
                                    <option value="USA">USA</option>
                                    <option value="UK">United Kingdom</option>
                                    </select>
                            </div>
                        </div>
                    </form>
                </section>

                <section id="review-order-section" class="bg-white p-6 sm:p-8 rounded-lg shadow-md border border-gray-100 hidden">
                    <h2 class="text-xl sm:text-2xl font-bold text-ash-dark mb-6 border-b pb-4">2. Review & Confirm</h2>
                    
                    <div class="space-y-6">
                        <div>
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="text-lg font-semibold text-gray-900">Shipping Address</h3>
                                <button id="edit-shipping-btn" class="text-sm font-medium text-ash-red hover:text-red-700" onclick="goToStep(1)">Change</button>
                            </div>
                            <div class="text-sm text-gray-700 p-4 bg-gray-50 rounded-md border">
                                <p id="review-address-name" class="font-medium"></p>
                                <p id="review-address-line1"></p>
                                <p id="review-address-line2"></p>
                                <p id="review-contact-info" class="mt-2 text-gray-500"></p>
                            </div>
                        </div>

                        <div>
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="text-lg font-semibold text-gray-900">Items in Order</h3>
                                <a href="cart.html" id="edit-order-btn" class="text-sm font-medium text-ash-red hover:text-red-700">Edit Cart</a>
                            </div>
                            <div id="review-items-list" class="divide-y divide-gray-100 border border-gray-200 rounded-md p-2">
                                </div>
                             <p id="review-shipping-cost" class="text-sm font-medium text-gray-700 mt-2 text-right">Shipping: ‚Ç¶0.00</p>
                        </div>
                    </div>
                </section>

             <section id="payment-section" class="bg-white p-6 sm:p-8 rounded-lg shadow-md border border-gray-100 hidden">
    <h2 class="text-xl sm:text-2xl font-bold text-ash-dark mb-6 border-b pb-4">3. Payment</h2>
    
    <div class="space-y-6">
        <p class="text-gray-700">Please select your preferred payment method:</p>

        <div class="space-y-4">
            
            <div class="relative flex items-start border border-gray-300 rounded-md p-4 transition-all focus-within:ring-2 focus-within:ring-ash-red">
                <div class="flex items-center h-5">
                    <input id="payment-paystack" name="payment-method" type="radio" value="Paystack/Card" checked class="focus:ring-ash-red h-4 w-4 text-ash-red border-gray-300" onchange="hideBankTransferDetails()">
                </div>
                <div class="ml-3 text-sm flex-1">
                    <label for="payment-paystack" class="font-medium text-gray-900 flex justify-between items-center">
                        Paystack
                        <img src="https://i.imgur.com/fuT8ucM.png" alt="Paystack" class="h-5">
                    </label>
                    
                    <p id="paystack-description" class="text-gray-500 mt-1">
                        Pay securely with your Visa, MasterCard, or Verve card.
                    </p>
                    <div id="paystack-redirection-message" class="flex items-center text-sm font-semibold text-ash-red mt-2 p-2 bg-red-50 rounded-md">
                        <svg class="w-4 h-4 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
                        After clicking ‚ÄúConfirm & Pay Now‚Äù, you will be redirected to Paystack to complete your purchase securely.
                    </div>
                </div>
            </div>
            <div class="relative flex items-start border border-gray-300 rounded-md p-4 transition-all focus-within:ring-2 focus-within:ring-ash-red">
                <div class="flex items-center h-5">
                    <input id="payment-bank" name="payment-method" type="radio" value="Bank Transfer" class="focus:ring-ash-red h-4 w-4 text-ash-red border-gray-300" onchange="showBankTransferDetails()">
                </div>


                <div class="ml-3 text-sm flex-1">
                    <label for="payment-bank" class="font-medium text-gray-900">
                        Direct Bank Transfer (Manual)
                    </label>
                    <p id="bank-description" class="text-gray-500">View details below and complete payment manually.</p>
                    
                    <div id="bank-details-info" class="mt-3 p-3 bg-gray-100 rounded-md border border-gray-200" style="display:none;">
                        <h4 class="font-bold text-ash-dark mb-3 text-base">Select Account for Transfer:</h4>

                        <div id="account-dropdowns" class="space-y-3">
                            
                            <div class="border border-gray-300 rounded-lg overflow-hidden">
                                <button type="button" 
                                        class="bank-toggle w-full flex justify-between items-center p-3 font-semibold text-left transition duration-150 text-base" 
                                        data-target="moniepoint-details" 
                                        data-name="Moniepoint"
                                        aria-expanded="false"
                                        onclick="toggleBankDetails('moniepoint-details')">
                                    <span class="flex items-center">
                                        <img src="https://i.imgur.com/GlrvtEQ.png" alt="Moniepoint Logo" class="h-5 w-auto mr-3">
                                        Moniepoint MFB
                                    </span>
                                    <svg class="w-4 h-4 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                                </button>
                                <div id="moniepoint-details" class="bank-details-content p-3 pt-0 bg-white" style="display: none;">
                                    <hr class="mb-2 border-gray-200">
                                    <p class="text-sm font-mono break-words">
                                        <span class="font-bold block">Account Name: Outflickz Limited</span>
                                        <span class="font-bold block mt-1">Account Number: 6515769257</span>
                                    </p>
                                </div>
                            </div>

                        </div>
                        <div id="bank-transfer-receipt-upload" class="hidden mt-4 pt-3 border-t border-gray-300">
                            <h4 class="font-bold text-ash-dark mb-2 text-base">Upload Payment Receipt <span class="text-ash-red">*</span></h4>
                            <p class="text-xs text-gray-500 mb-2">Upload a screenshot/proof of payment to proceed with manual verification.</p>
                            <input type="file" id="bank-receipt-upload" name="bank-receipt-upload" accept="image/*, application/pdf" class="w-full text-sm text-gray-900 border border-gray-300 rounded-sm cursor-pointer bg-white file:py-2 file:px-4 file:border-0 file:bg-ash-red file:text-white hover:file:bg-red-700 transition">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="mt-6 border-t border-gray-200 pt-4">
            <div class="flex justify-between items-center">
                <p class="text-lg font-bold text-ash-dark">Total Due Now</p>
                <p class="text-2xl font-extrabold text-ash-red">‚Ç¶<span id="summary-estimated-total-final">0.00</span></p>
            </div>
            <p class="text-xs text-gray-500 mt-1">By clicking "Confirm & Pay Now", you agree to our Terms of Use.</p>
        </div>
    </div>
</section>
                
                <div class="pt-6 border-t border-gray-200">
                    <button id="checkout-next-btn" class="w-full bg-ash-red text-white hover:bg-red-700 transition duration-300 font-semibold py-4 rounded-sm shadow-lg uppercase tracking-widest text-base disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        <span id="checkout-btn-text">Continue to Review</span>
                    </button>
                    <a href="cart.html" class="mt-4 block text-center text-sm font-medium text-gray-600 hover:text-ash-red transition">
                        &leftarrow; Return to Cart
                    </a>
                </div>

            </div>
            
            <div class="mt-8 lg:mt-0 lg:col-span-1">
                <div class="bg-color-white p-6 rounded-lg shadow-xl border border-gray-100 lg:sticky lg:top-20">
                    <h2 class="text-xl font-bold text-ash-dark mb-6">Order Summary</h2>
                    
                    <div id="summary-items-placeholder" class="mb-4 hidden">
                         <h3 class="text-sm font-semibold text-ash-dark mb-2">Items:</h3>
                         <div id="summary-items-list" class="divide-y divide-gray-100 border border-gray-200 rounded-md p-2 max-h-48 overflow-y-auto">
                            </div>
                    </div>

                    <div class="space-y-4">
                        <div class="flex justify-between text-sm text-gray-700">
                            <span>Subtotal (Items)</span>
                            <span id="summary-subtotal" class="font-semibold">‚Ç¶0.00</span>
                        </div>
                        <div class="flex justify-between text-sm text-gray-700">
                            <span>Shipping</span>
                            <span id="summary-shipping-cost" class="font-semibold">‚Ç¶0.00</span>
                        </div>
                        <div class="flex justify-between text-sm text-gray-700 border-t border-gray-200 pt-4">
                            <span>Tax Estimate (0%)</span>
                            <span id="summary-tax-estimate" class="font-semibold">‚Ç¶0.00</span>
                        </div>
                    </div>

                    <div class="border-t border-gray-300 pt-4 mt-6 flex justify-between items-center">
                        <p class="text-lg font-bold text-ash-dark">Estimated Total</p>
                        <p id="summary-estimated-total" class="text-xl font-extrabold text-ash-red">‚Ç¶0.00</p>
                    </div>

                    <p class="text-xs text-gray-500 mt-2 text-right">Final price includes all duties and fees.</p>

                    <div class="mt-6 border-t border-gray-100 pt-6">
                        <h3 class="text-sm font-semibold text-ash-dark mb-3">Guaranteed Security</h3>
                        <div class="flex items-center text-sm text-gray-700 space-x-4">
                            <i class="fas fa-lock text-lg text-green-600"></i>
                            <p>All transactions are secured by Paystack and Bank Transfer.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </main>
    
   <footer class="bg-black text-gray-300 py-6 sm:py-14 border-t border-gray-800 mt-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-4 gap-8">
                
                <div class="col-span-2 lg:col-span-1">
                    <a href="homepage.html" class="flex items-center mb-3 sm:mb-4"> 
                        <img src="https://i.imgur.com/PZLMws6.jpeg" alt="Outflickz Logo" class="w-auto h-8 filter grayscale invert">
                    </a>
                    <p class="text-xs sm:text-sm text-gray-500"> 
                        The home of exclusive street wear and limited edition drops. Elevate your style.
                    </p>
                    <div class="flex space-x-4 mt-4 text-gray-400">
                        <a href="https://www.instagram.com/outflickz01?igsh=Yzl3d3BjaGt5djll" aria-label="Instagram" class="hover:text-ash-red transition"><i class="fab fa-instagram"></i></a>
                        <a href="https://www.tiktok.com/@outflickz?_r=1&_t=ZS-92AInaYzuTt" aria-label="TikTok" class="hover:text-ash-red transition"><i class="fab fa-tiktok"></i></a>
                        <a href="https://www.facebook.com/profile.php?id=61584421929170" aria-label="Facebook" class="hover:text-ash-red transition"><i class="fab fa-facebook-f"></i></a>
                    </div>
                </div>

                <div class="col-span-1">
                    <h3 class="text-sm font-semibold uppercase tracking-wider text-white mb-3 sm:mb-4">Quick Links</h3> 
                    <ul class="space-y-1.5 sm:space-y-2 text-xs sm:text-sm"> 
                        <li><a href="wearscollection.html" class="text-gray-400 hover:text-ash-red transition">Wears</a></li>
                        <li><a href="newarrivals.html" class="text-gray-400 hover:text-ash-red transition">New Arrivals</a></li>
                        <li><a href="capcollection.html" class="text-gray-400 hover:text-ash-red transition">Caps</a></li>
                        <li><a href="preorder.html" class="text-gray-400 hover:text-ash-red transition">Pre-Order</a></li>
                    </ul>
                </div>

                <div class="col-span-1">
                    <h3 class="text-sm font-semibold uppercase tracking-wider text-white mb-3 sm:mb-4">Customer Care</h3> 
                    <ul class="space-y-1.5 sm:space-y-2 text-xs sm:text-sm"> 
                        <li><a href="contact.html" class="text-gray-400 hover:text-ash-red transition">Contact Us</a></li>
                        <li><a href="shipping_returns.html" class="text-gray-400 hover:text-ash-red transition">Shipping & Returns</a></li>
                        <li><a href="faq.html" class="text-gray-400 hover:text-ash-red transition">FAQ</a></li>
                        <li><a href="size_guide.html" class="text-gray-400 hover:text-ash-red transition">Size Guide</a></li>
                    </ul>
                </div>

                <div class="col-span-2 md:col-span-1">
                    <h3 class="text-sm font-semibold uppercase tracking-wider text-white mb-3 sm:mb-4">Get In Touch</h3> 
                    <address class="text-xs sm:text-sm not-italic space-y-2"> 
                        <p class="text-gray-400">
                            <i class="fas fa-map-marker-alt mr-2 text-ash-red"></i> Lagos , Nigeria
                        </p>
                        <p class="text-gray-400">
                            <i class="fas fa-envelope mr-2 text-ash-red"></i> outflickzlimited@gmail.com 
                        </p>
                        <p class="text-gray-400">
                            <i class="fas fa-phone mr-2 text-ash-red"></i> +234 7042882706
                        </p>
                    </address>
                </div>
                
            </div>

            <div class="border-t border-gray-800 mt-6 sm:mt-10 pt-4 sm:pt-6"> 
                <p class="text-center text-xs text-gray-500">
                    &copy; 2025 Outflickz. All rights reserved. | <a href="#" class="hover:text-ash-red">Privacy Policy</a> | <a href="#" class="hover:text-ash-red">Terms of Use</a>
                </p>
            </div>
        </div>
    </footer>
    
    <a href="https://t.me/+2347042882706" 
        target="_blank"
        class="fixed bottom-6 right-24 z-50 
               bg-[#24A1DE] text-white 
               p-3 rounded-full 
               shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105 
               flex items-center justify-center w-14 h-14" 
        aria-label="Chat with us on Telegram">
        
        <i class="fab fa-telegram-plane fa-2x"></i>
    </a>
    
    <a href="https://wa.me/2347042882706?text=HELLO%20OUTFLICKZ!%20My%20name%20is%20..."
        target="_blank"
        class="fixed bottom-6 right-6 z-50 
               bg-[#25D366] text-white 
               p-3 rounded-full 
               shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105 
               flex items-center justify-center w-14 h-14" 
        aria-label="Chat with us on WhatsApp">
        
        <i class="fab fa-whatsapp fa-2x"></i>
    </a>
    
<script>
    // --- CONFIGURATION ---
    const API_BASE_URL = 'https://outflickzz.netlify.app';
    const CART_STORAGE_KEY = 'outflickzCartCount';
    const LOCAL_CART_KEY = 'outflickzLocalCart';
    const BUY_NOW_KEY = 'buyNowItem'; 
    const AUTH_TOKEN_KEY = 'userAccessToken';
    const REFRESH_ENDPOINT = `${API_BASE_URL}/api/auth/refresh`;
    const DEFAULT_ADMIN_EMAIL = "outflickzlimited@gmail.com"; 
    const PAYSTACK_PUBLIC_KEY = 'pk_live_914b068e58d4ff0d8c50e5a035cae86b1142da35'; 
    const CURRENCY_SYMBOL = '‚Ç¶';

    let checkoutStep = 1; 
    const STEPS = [
        { id: 1, name: 'Shipping Info', sectionId: 'shipping-info-section' },
        { id: 2, name: 'Review Order', sectionId: 'review-order-section' },
        { id: 3, name: 'Payment', sectionId: 'payment-section' }
    ];

    // --- AUTHENTICATION HELPERS ---
    function isUserLoggedIn() {
        return localStorage.getItem('outflickzAuthStatus') === 'loggedIn';
    }

    async function secureUserFetch(url, options = {}) {
        let token = localStorage.getItem(AUTH_TOKEN_KEY);
        if (token) {
            options.headers = { ...options.headers, 'Authorization': `Bearer ${token}` };
        }
        let response = await fetch(url, options);
        if (response.status === 401) {
            try {
                const refreshResponse = await fetch(REFRESH_ENDPOINT, { method: 'POST', credentials: 'include' });
                if (refreshResponse.ok) {
                    const data = await refreshResponse.json();
                    localStorage.setItem(AUTH_TOKEN_KEY, data.accessToken);
                    options.headers['Authorization'] = `Bearer ${data.accessToken}`;
                    response = await fetch(url, options);
                } else {
                    handleLogout();
                }
            } catch (error) {
                handleLogout();
            }
        }
        return response;
    }

    function handleLogout() {
        localStorage.removeItem(AUTH_TOKEN_KEY);
        localStorage.setItem('outflickzAuthStatus', 'loggedOut');
        displayMessage("Session expired. Please log in again.");
        setTimeout(() => window.location.href = 'useraccount.html', 2000);
    }

    // --- UI & MESSAGING ---
    function displayMessage(message) {
        const modalContainer = document.getElementById('message-modal-container');
        const modalText = document.getElementById('message-modal-text');
        if (modalContainer && modalText) {
            modalText.textContent = message;
            modalContainer.classList.remove('hidden');
            setTimeout(hideMessageModal, 5000);
        }
    }

    function hideMessageModal() {
        const modalContainer = document.getElementById('message-modal-container');
        if (modalContainer) modalContainer.classList.add('hidden');
    }

    function updateCartBadge() {
        const badge = document.getElementById('cart-badge');
        if (!badge) return;
        const count = parseInt(localStorage.getItem(CART_STORAGE_KEY) || '0');
        badge.textContent = count;
        badge.classList.toggle('hidden', count <= 0);
    }

    function getCollectionType(productName) {
        if (!productName) return 'WearsCollection'; 
        const lowerName = productName.toLowerCase();
        if (lowerName.includes('tee') || lowerName.includes('tank') || lowerName.includes('wears')) return 'WearsCollection';
        if (lowerName.includes('cap') || lowerName.includes('curve')) return 'CapCollection';
        if (lowerName.includes('arrival') || lowerName.includes('polo')) return 'NewArrivals';
        return 'WearsCollection';
    }

    /**
     * FIXED: fetchInitialCartData
     * Removed the guest/cart API call. Now handles guest checkout via local storage directly.
     */
    async function fetchInitialCartData() {
        const itemsListEl = document.getElementById('review-items-list');
        const paymentBtn = document.getElementById('checkout-next-btn');
        
        const localCart = JSON.parse(localStorage.getItem(LOCAL_CART_KEY) || '[]');
        const buyNowItemJSON = localStorage.getItem(BUY_NOW_KEY);

        // --- FLOW A: BUY NOW (Priority) ---
        if (buyNowItemJSON) {
            let rawItem = JSON.parse(buyNowItemJSON);
            const sanitizedItem = {
                productId: rawItem.productId,
                name: rawItem.name || "Product",
                productType: (rawItem.productType && String(rawItem.productType) !== "undefined") 
                             ? rawItem.productType 
                             : getCollectionType(rawItem.name),
                size: rawItem.size || "Standard",
                color: rawItem.color || "Default",
                price: parseFloat(rawItem.price) || 0,
                quantity: parseInt(rawItem.quantity) || 1,
                imageUrl: rawItem.imageUrl || "",
                variationIndex: (rawItem.variationIndex !== undefined && rawItem.variationIndex !== null) 
                                ? parseInt(rawItem.variationIndex, 10) 
                                : 0,
                variation: rawItem.variation || rawItem.size || "Standard"
            };

            try {
                // Calculate pricing via backend to get current shipping/tax
                const response = await fetch(`${API_BASE_URL}/api/orders/calculate-buy-now`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(sanitizedItem) 
                });

                const data = await response.json();
                if (!response.ok) throw new Error(data.message || 'Server rejected item details.');

                renderCartData(data, paymentBtn);
                return;
            } catch (error) {
                console.error("Buy Now Error:", error);
                displayMessage(`Checkout Error: ${error.message}`);
                return;
            }
        }

        // --- FLOW B: STANDARD CART (User or Guest) ---
        if (isUserLoggedIn()) {
            // Logged in users fetch synced cart from server
            try {
                const response = await secureUserFetch(`${API_BASE_URL}/api/users/cart`);
                if (!response.ok) throw new Error('Failed to fetch cart.');
                const cartData = await response.json();
                renderCartData(cartData, paymentBtn);
            } catch (error) {
                displayMessage("Could not load bag.");
            }
        } else {
            // Guest users use LOCAL_CART_KEY data directly
            if (localCart.length === 0) {
                displayMessage('Your shopping bag is empty.');
                setTimeout(() => window.location.href = 'homepage.html', 1500);
                return;
            }

            // Simple calculation for guest checkout review
            const subtotal = localCart.reduce((acc, item) => acc + (item.price * item.quantity), 0);
            const guestCartData = {
                items: localCart,
                subtotal: subtotal,
                shippingFee: 0, // Backend logic usually determines this; default 0 until final placement
                tax: 0,
                total: subtotal
            };
            renderCartData(guestCartData, paymentBtn);
        }
    }

    function renderCartData(data, paymentBtn) {
        const subtotal = data.subtotal || 0;
        const shipping = data.shippingFee || data.shipping || 0;
        const tax = data.tax || 0;
        const total = data.total || data.estimatedTotal || (subtotal + shipping + tax);

        document.getElementById('summary-subtotal').textContent = `‚Ç¶${subtotal.toLocaleString()}`;
        document.getElementById('summary-shipping-cost').textContent = `‚Ç¶${shipping.toLocaleString()}`;
        document.getElementById('summary-tax-estimate').textContent = `‚Ç¶${tax.toLocaleString()}`;
        document.getElementById('summary-estimated-total').textContent = `‚Ç¶${total.toLocaleString()}`;
        document.getElementById('summary-estimated-total-final').textContent = total.toLocaleString();

        localStorage.setItem('outflickzOrderSubtotal', subtotal.toFixed(2));
        localStorage.setItem('outflickzOrderShipping', shipping.toFixed(2));
        localStorage.setItem('outflickzOrderTax', tax.toFixed(2));
        localStorage.setItem('outflickzOrderTotal', total.toFixed(2));
        localStorage.setItem('outflickzOrderItems', JSON.stringify(data.items));

        document.getElementById('review-items-list').innerHTML = data.items.map(item => `
            <div class="flex items-center justify-between py-3 border-b border-gray-100 last:border-0">
                <div class="flex items-center">
                    <img src="${item.imageUrl}" class="w-16 h-16 object-cover rounded-md mr-4">
                    <div>
                        <h4 class="font-medium text-gray-800">${item.name}</h4>
                        <p class="text-sm text-gray-500">Qty: ${item.quantity} | Size: ${item.size || 'N/A'}</p>
                        <p class="text-sm font-semibold text-gray-700">‚Ç¶${item.price.toLocaleString()}</p>
                    </div>
                </div>
            </div>
        `).join('');
        paymentBtn.disabled = false;
    }

    // --- STEP NAVIGATION ---
    function updateCheckoutView() {
        STEPS.forEach(step => {
            const indicator = document.getElementById(`step-indicator-${step.id}`);
            const section = document.getElementById(step.sectionId);
            section.classList.toggle('hidden', step.id !== checkoutStep);
            
            if (step.id < checkoutStep) {
                indicator.className = 'step-indicator step-complete';
                indicator.innerHTML = '<i class="fas fa-check"></i>';
            } else if (step.id === checkoutStep) {
                indicator.className = 'step-indicator step-active';
                indicator.textContent = step.id;
            } else {
                indicator.className = 'step-indicator step-inactive';
                indicator.textContent = step.id;
            }
        });

        const nextBtn = document.getElementById('checkout-next-btn');
        const btnText = document.getElementById('checkout-btn-text');
        
        if (checkoutStep === 1) {
            btnText.textContent = 'Continue to Review';
            nextBtn.onclick = validateAndProceedToReview;
        } else if (checkoutStep === 2) {
            btnText.textContent = 'Proceed to Payment';
            nextBtn.onclick = () => { checkoutStep = 3; updateCheckoutView(); window.scrollTo(0, 0); };
        } else if (checkoutStep === 3) {
            btnText.textContent = 'Confirm & Pay Now';
            nextBtn.onclick = handleFinalOrderPlacement;
        }
    }

    function validateAndProceedToReview() {
        const form = document.getElementById('shipping-form');
        if (!form.checkValidity()) { form.reportValidity(); return; }

        const shippingData = {
            firstName: document.getElementById('first-name').value.trim(),
            lastName: document.getElementById('last-name').value.trim(),
            email: document.getElementById('email').value.trim(),
            street: document.getElementById('address-line-1').value.trim(),
            city: document.getElementById('city').value.trim(),
            state: document.getElementById('state').value,
            zipCode: document.getElementById('zip-code').value.trim() || "N/A", 
            country: document.getElementById('country').value,
        };

        localStorage.setItem('outflickzShippingData', JSON.stringify(shippingData));

        document.getElementById('review-address-name').textContent = `${shippingData.firstName} ${shippingData.lastName}`;
        document.getElementById('review-address-line1').textContent = shippingData.street;
        document.getElementById('review-address-line2').textContent = `${shippingData.city}, ${shippingData.state} ${shippingData.zipCode}, ${shippingData.country}`;
        document.getElementById('review-contact-info').textContent = shippingData.email;

        checkoutStep = 2;
        updateCheckoutView();
        window.scrollTo(0, 0);
    }

    // --- PAYMENT PROCESSING ---
    async function handleFinalOrderPlacement() {
        const method = document.querySelector('input[name="payment-method"]:checked');
        if (!method) return displayMessage('Select a payment method.');

        const total = parseFloat(localStorage.getItem('outflickzOrderTotal') || 0);
        const shippingData = JSON.parse(localStorage.getItem('outflickzShippingData'));
        
        if (total <= 0 || !shippingData) return displayMessage('Order data missing.');

        if (method.value === 'Paystack/Card') {
            processPaystackPayment(total, shippingData.email);
        } else {
            processBankTransferOrder(total, shippingData);
        }
    }

    async function processPaystackPayment(totalAmount, email) {
        const payBtn = document.getElementById('checkout-next-btn');
        payBtn.disabled = true;
        payBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Initializing...';

        const buyNowItemJSON = localStorage.getItem(BUY_NOW_KEY);
        const itemsToOrder = buyNowItemJSON 
            ? [JSON.parse(buyNowItemJSON)] 
            : JSON.parse(localStorage.getItem('outflickzOrderItems'));

        try {
            const endpoint = isUserLoggedIn() ? '/api/orders/place/paystack' : '/api/orders/place/guest/paystack';
            const fetchMethod = isUserLoggedIn() ? secureUserFetch : fetch;

            const response = await fetchMethod(`${API_BASE_URL}${endpoint}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    shippingAddress: JSON.parse(localStorage.getItem('outflickzShippingData')),
                    totalAmount,
                    subtotal: localStorage.getItem('outflickzOrderSubtotal'),
                    shippingFee: localStorage.getItem('outflickzOrderShipping'),
                    tax: localStorage.getItem('outflickzOrderTax'),
                    orderItems: itemsToOrder 
                })
            });

            const data = await response.json();
            if (!response.ok) throw new Error(data.message);

            const handler = PaystackPop.setup({
                key: PAYSTACK_PUBLIC_KEY,
                email,
                amount: Math.round(totalAmount * 100),
                ref: data.orderReference,
                callback: (res) => handlePaystackSuccessRedirect(data.orderId, res.reference),
                onClose: () => {
                    payBtn.disabled = false;
                    payBtn.innerHTML = 'Confirm & Pay Now';
                }
            });
            handler.openIframe();
        } catch (e) {
            displayMessage(e.message);
            payBtn.disabled = false;
        }
    }

    async function processBankTransferOrder(totalAmount, shippingAddress) {
        const receiptInput = document.getElementById('bank-receipt-upload');
        if (!receiptInput.files.length) return displayMessage('Please upload payment receipt.');

        const payBtn = document.getElementById('checkout-next-btn');
        payBtn.disabled = true;
        payBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Placing Order...';

        const itemsToOrder = JSON.parse(localStorage.getItem('outflickzOrderItems'));

        const formData = new FormData();
        formData.append('receipt', receiptInput.files[0]);
        formData.append('shippingAddress', JSON.stringify(shippingAddress));
        formData.append('paymentMethod', 'Bank Transfer');
        formData.append('totalAmount', totalAmount);
        formData.append('subtotal', localStorage.getItem('outflickzOrderSubtotal'));
        formData.append('shippingFee', localStorage.getItem('outflickzOrderShipping'));
        formData.append('tax', localStorage.getItem('outflickzOrderTax'));
        formData.append('orderItems', JSON.stringify(itemsToOrder));

        try {
            const endpoint = isUserLoggedIn() ? '/api/orders/place/pending' : '/api/orders/place/guest/pending';
            const fetchMethod = isUserLoggedIn() ? secureUserFetch : fetch;
            
            const res = await fetchMethod(`${API_BASE_URL}${endpoint}`, { method: 'POST', body: formData });
            const data = await res.json();
            if (!res.ok) throw new Error(data.message);
            
            handleOrderSuccess(data.orderId);
        } catch (e) {
            displayMessage(e.message);
            payBtn.disabled = false;
        }
    }

    function handleOrderSuccess(orderId) {
        localStorage.removeItem(LOCAL_CART_KEY);
        localStorage.setItem(CART_STORAGE_KEY, '0');
        localStorage.removeItem(BUY_NOW_KEY);
        window.location.href = `orderconfirmation.html?id=${orderId}&method=success`;
    }

    function handlePaystackSuccessRedirect(mongoId, ref) {
        handleOrderSuccess(mongoId);
    }

    // --- INITIALIZATION ---
    document.addEventListener('DOMContentLoaded', () => {
        if (isUserLoggedIn()) {
            secureUserFetch(`${API_BASE_URL}/api/users/account`).then(res => res.json()).then(userData => {
                if (userData.email) {
                    document.getElementById('email').value = userData.email;
                    const addr = userData.address || {};
                    const prof = userData.profile || {};
                    document.getElementById('first-name').value = prof.firstName || '';
                    document.getElementById('last-name').value = prof.lastName || '';
                    document.getElementById('address-line-1').value = addr.street || '';
                    document.getElementById('city').value = addr.city || '';
                    document.getElementById('state').value = addr.state || '';
                    document.getElementById('zip-code').value = addr.zipCode || '';
                }
            });
        }
        
        updateCartBadge();
        fetchInitialCartData();
        updateCheckoutView();
    });
</script>
</body>
</html>